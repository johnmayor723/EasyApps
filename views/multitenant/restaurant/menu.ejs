<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%=name%></title>
  <link rel="stylesheet" href="/multitenant/css/restaurant/index.css" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
  :root {
    --primary-color: <%= tenant?.branding?.primaryColor || '#d4af37' %>;
    --secondary-color: <%= tenant?.branding?.secondaryColor || '#ffffff' %>;
    --brand-dark: #000000;
    --brand-light: #faf9f7;
  }
  .cart-modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.6);
}

.cart-modal-content {
  background: #fff;
  width: 420px;
  max-width: 95%;
  margin: 60px auto;
  border-radius: 12px;
  overflow: hidden;
  animation: slideDown 0.25s ease;
}

@keyframes slideDown {
  from {
    transform: translateY(-40px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.cart-header {
  padding: 16px;
  background: #111;
  color: #fff;
  display: flex;
  justify-content: space-between;
}

.cart-close {
  background: none;
  border: none;
  font-size: 24px;
  color: white;
  cursor: pointer;
}

.cart-body {
  padding: 16px;
  max-height: 350px;
  overflow-y: auto;
}

.cart-item {
  display: flex;
  justify-content: space-between;
  padding: 10px 0;
  border-bottom: 1px solid #eee;
}

.cart-item-name {
  font-weight: 600;
}

.cart-item-qty {
  font-size: 13px;
  color: #777;
}

.cart-footer {
  padding: 16px;
  border-top: 1px solid #eee;
}

.cart-total {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 10px;
}

.whatsapp-btn {
  width: 100%;
  padding: 12px;
  background: #25D366;
  border: none;
  color: white;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
}

.whatsapp-btn:hover {
  background: #1ebe5d;
}

.cart-empty {
  text-align: center;
  padding: 40px;
  color: #777;
}
.cart-qty-control {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 6px;
}

.cart-qty-control button {
  width: 28px;
  height: 28px;
  border: none;
  background: #111;
  color: white;
  font-size: 18px;
  border-radius: 6px;
  cursor: pointer;
}

.cart-qty-control button:hover {
  background: #333;
}

.cart-qty-control span {
  font-weight: bold;
  min-width: 20px;
  text-align: center;
}


</style>

</head>
<body>

  <!-- NAVIGATION -->
  <header class="navbar">
    <div class="nav-container">
      <div class="logo"><%=name%></div>

     <nav class="nav-links">
        <a href="/multitenant/shop/<%= tenant.tenantId %>/slug" >HOME</a>
        <a href="/multitenant/shop/<%= tenant.tenantId %>/menu/" class="active">MENU</a>
        <a href="/multitenant/shop/<%= tenant.tenantId %>/reservations">RESERVATIONS</a>
        <a href="/multitenant/shop/<%= tenant.tenantId %>/rewards">REWARDS</a>
        <a href="/multitenant/shop/<%= tenant.tenantId %>/track-order">TRACK ORDER</a>
       <a href="#" onclick="openCartModal(); return false;" class="cart-link">
        ðŸ›’ Cart
        <span id="cart-count" class="cart-count">
          <%= session.cart?.totalQty || 0 %>
        </span>
      </a>


      </nav>
    </div>
  </header>

  
 
<!-- MENU SECTION -->
<section class="menu-page">

  <div class="menu-hero">
  <span class="menu-subtitle">EXPLORE OUR</span>
  <h1>Menu</h1>
</div>


  <!-- CATEGORY FILTER -->
  <div class="menu-filter">
    <div class="filters">
      <button class="active">ALL</button>
      <button>SPECIALS</button>
      <button>APPETIZERS</button>
      <button>MAIN COURSES</button>
      <button>DESSERTS</button>
      <button>DRINKS</button>
    </div>

    <a href="#" style="padding: 10px 13px;background-color: #d3b325;color: whitesmoke;text-decoration: none;border-radius: 10px;" onclick="openCartModal(); return false;" class="cart-link">
        ðŸ›’ Cart
        <span id="cart-count" class="cart-count">
          <%= session.cart?.totalQty || 0 %>
        </span>
      </a>
  </div>

  <!-- MENU GRID -->
  <!-- MENU GRID -->
<div class="menu-grid">
  <% if (menus && menus.length) { %>
    <% menus.forEach(menu => { %>
      <div class="menu-card <%= menu.category ? menu.category.toLowerCase() : '' %>">
        <% if(menu.isVegetarian) { %>
          <span class="badge">Vegetarian</span>
        <% } %>
        <img src="<%= menu.image %>" alt="<%= menu.name %>">
        <div class="menu-info">
          <h3><%= menu.name %></h3>
          <span class="price">$<%= menu.price %></span>
          <p><%= menu.description %></p>
          <form action="/multitenant/cart/add/<%= menu._id %>?tenantId=<%= tenant.tenantId %>" method="POST">
            <input hidden="number" name="price" value="<%= menu.price %>">
            <button type="submit" class="add-btn">+ ADD TO ORDER</button>
          </form>
          
        </div>
      </div>
    <% }) %>
  <% } else { %>
    <!-- Fallback to static content if no menu items -->
    <div class="menu-card">
     <H2>NO ITEMS IN YOUR CART</H2>
    </div>

  <% } %>
</div>

</section>
<!-- CART MODAL -->
<div id="cartModal" class="cart-modal">

  <div class="cart-modal-content">

    <!-- HEADER -->
    <div class="cart-header">
      <h3>Your Cart</h3>
      <button class="cart-close" onclick="closeCartModal()">&times;</button>
    </div>


    <!-- BODY -->
    <div style="color: #333;" class="cart-body">

      <% if (!session.cart || session.cart.items.length === 0) { %>

        <div class="cart-empty">
          Your cart is empty
        </div>

      <% } else { %>

        <% session.cart.items.forEach(item => { %>

          <div class="cart-item">

            <div>

              <div class="cart-item-name">
                <%= item.name %>
              </div>


              <!-- QTY CONTROLS -->
              <div class="cart-qty-control">

                <button onclick="updateQty('<%= item._id %>', -1)">
                  âˆ’
                </button>

                <span id="qty-<%= item._id %>">
                  <%= item.qty %>
                </span>

                <button onclick="updateQty('<%= item._id %>', 1)">
                  +
                </button>

              </div>

            </div>


            <div class="cart-item-price">
              â‚¦<%= item.total.toFixed(2) %>
            </div>

          </div>

        <% }) %>

      <% } %>

    </div>


    <!-- FOOTER -->
    <div class="cart-footer">

      <div class="cart-total">
        Total: â‚¦<%= session.cart?.totalPrice?.toFixed(2) || "0.00" %>
      </div>

      <button onclick="sendWhatsAppOrder()" class="whatsapp-btn">
        Place Order via WhatsApp
      </button>

    </div>

  </div>

</div>


<!-- FOOTER -->
<footer class="footer">
  <div class="footer-container">

    <!-- BRAND -->
    <div class="footer-brand">
      <h3><%=name%></h3>
      <p>
        Where culinary excellence meets timeless elegance.
        Experience the art of fine dining in an atmosphere of
        sophisticated comfort.
      </p>
    </div>

    <!-- QUICK LINKS -->
    <div class="footer-links">
      <h4>QUICK LINKS</h4>
      <a href="#">Home</a>
      <a href="#">Menu</a>
      <a href="#">Reservations</a>
      <a href="#">Rewards</a>
      <a href="#">Track Order</a>
    </div>

    <!-- CONTACT -->
    <div class="footer-contact">
      <h4>CONTACT</h4>
      <p><%=contact.address%></p>
      <p><%=contact.city%>, <%=contact.state%> <%=contact.zip%></p>
      <p><%=contact.phone%></p>
    </div>

  </div>

  <div class="footer-bottom">
    Â© 2026 La Maison. All rights reserved.
  </div>
</footer>

<script>

function openCartModal() {
  document.getElementById("cartModal").style.display = "block";
}

function closeCartModal() {
  document.getElementById("cartModal").style.display = "none";
}

window.onclick = function(e) {
  const modal = document.getElementById("cartModal");

  if (e.target === modal) {
    modal.style.display = "none";
  }
};


function sendWhatsAppOrder() {

  const rawPhone = "<%= contact.phone || '' %>";
  let phone = rawPhone.replace(/\D/g, '');

  // common normalization: if local format starts with 0 (e.g. 08012345678) convert to 234XXXXXXXXX
  if (phone.length === 11 && phone.startsWith('0')) {
    phone = '234' + phone.slice(1);
  }

  // enforce format: must start with 234 and be exactly 12 digits long (234 + 10 digits)
  if (!/^234\d{10}$/.test(phone)) {
    alert('Invalid phone format. Expected: 234XXXXXXXXX (12 digits, starting with 234).');
    return;
  }

  <% 
    // build the message on the server to avoid injecting unescaped strings into client JS
    var waMessage = 'Hello, I want to place an order:\n\n';
    if (typeof session !== 'undefined' && session && session.cart && Array.isArray(session.cart.items) && session.cart.items.length > 0) {
      session.cart.items.forEach(function(item) {
        waMessage += 'â€¢ ' + (item.name || '') + ' x ' + (item.qty || 0) + ' = â‚¦' + (item.total ? item.total.toFixed(2) : '0.00') + '\n';
      });
      waMessage += '\nTotal: â‚¦' + (session.cart.totalPrice ? session.cart.totalPrice.toFixed(2) : '0.00');
    }
  %>

  // message is already URL-encoded on the server to ensure it's safe in the client script
  const message = "<%= encodeURIComponent(waMessage) %>";

  const url = `https://wa.me/${phone}?text=${message}`;

  window.open(url, "_blank");

}

</script>
<script>
  // UPDATE QTY 
  async function updateQty(menuId, change) {
    try {
      const res = await fetch(`/multitenant/cart/update/${menuId}?tenantId=<%= tenant.tenantId %>`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ change })
      });
      const data = await res.json();
      if (data.success) {
        document.getElementById("cart-count").innerText = data.cart.totalQty;
        location.reload();
      }
    } catch (err) {
      console.error(err);
    }
  }
</script>

</body>
</html>
